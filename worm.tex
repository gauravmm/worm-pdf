% universal settings
\documentclass[smalldemyvopaper,11pt,twoside,onecolumn,openright,extrafontsizes]{memoir}

\usepackage[utf8x]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[osf]{Alegreya,AlegreyaSans}

% PACKAGE DEFINITION
% typographical packages
\usepackage{microtype} % for micro-typographical adjustments
\usepackage{setspace} % for line spacing
\usepackage{lettrine} % for drop caps and awesome chapter beginnings
\usepackage{titlesec} % for manipulation of chapter titles
\usepackage{tocloft}
\usepackage{amssymb}
\usepackage{comment}
\usepackage{etoolbox}

% for placeholder text
\usepackage{lipsum} % to generate Lorem Ipsum

% other
\usepackage{calc}
\usepackage{hologo}
\usepackage[hidelinks]{hyperref}
%\usepackage{showframe}

% PHYSICAL DOCUMENT SETUP
% media settings
\setstocksize{8.5in}{5.675in}
\settrimmedsize{8.5in}{5.5in}{*}
\setbinding{0.175in}
\setlrmarginsandblock{0.611in}{1.222in}{*}
\setulmarginsandblock{0.722in}{1.545in}{*}

% defining the title and the author
\title{Worm}
\author{John C. ``Wildbow'' McCrae}
\newcommand{\press}{\texttt{parahumans.wordpress.com}}

% custom second title page
\makeatletter
\newcommand*\halftitlepage{\begingroup % Misericords, T&H p 153
    \setlength\drop{0.1\textheight}
    \begin{center}
    \vspace*{\drop}
    \rule{\textwidth}{0in}\par
    {\Large\textsc\thetitle\par}
    \rule{\textwidth}{0in}\par
    \vfill
    \end{center}
\endgroup}
\makeatother

% custom title page
\thispagestyle{empty}
\makeatletter
\newlength\drop
\newcommand*\titleM{\begingroup % Misericords, T&H p 153
    \setlength\drop{0.15\textheight}
    \begin{center}
    \vspace*{\drop}
    \rule{\textwidth}{0in}\par
    {\HUGE\textsc\thetitle\par}
    \rule{\textwidth}{0in}\par
    {\Large\textit\theauthor\par}
    \vfill
    {\Large\scshape\press}
    \end{center}
\endgroup}
\makeatother

% chapter title manipulation
% padding with zero
\renewcommand*\thechapter{\ifnum\value{chapter}<10 0\fi\arabic{chapter}}
% chapter title display
\titleformat
{\chapter}
[display]
{\normalfont\scshape\huge}
{\HUGE\thechapter\centering}
{0pt}
{\vspace{18pt}\centering}[\vspace{42pt}]

% typographical settings for the body text
\setlength{\parskip}{0em}
\linespread{1.09}

% HEADER AND FOOTER MANIPULATION
    % for normal pages
    \nouppercaseheads
    \headsep = 0.16in
    \makepagestyle{mystyle} 
    \setlength{\headwidth}{\dimexpr\textwidth+\marginparsep+\marginparwidth\relax}
    \makerunningwidth{mystyle}{\headwidth}
    \makeevenhead{mystyle}{}{\textsf{\scriptsize\scshape\thetitle}}{}
    \makeoddhead{mystyle}{}{\textsf{\scriptsize\scshape\leftmark}}{}
    \makeevenfoot{mystyle}{}{\textsf{\scriptsize\thepage}}{}
    \makeoddfoot{mystyle}{}{\textsf{\scriptsize\thepage}}{}
    \makeatletter
    \makepsmarks{mystyle}{%
    \createmark{chapter}{left}{nonumber}{\@chapapp\ }{.\ }}
    \makeatother
    % for pages where chapters begin
    \makepagestyle{plain}
    \makerunningwidth{plain}{\headwidth}
    \makeevenfoot{plain}{}{}{}
    \makeoddfoot{plain}{}{}{}
    \pagestyle{mystyle}
% END HEADER AND FOOTER MANIPULATION

% table of contents customization
\renewcommand\contentsname{\normalfont\scshape Contents}
\renewcommand\cftchapterfont{\normalfont}
\renewcommand{\cftchapterpagefont}{\normalfont}
\renewcommand{\printtoctitle}{\centering\Huge}

\cftsetindents{section}{0em}{2em}
\cftsetindents{subsection}{0em}{2em}

\setlength{\cftbeforepartskip}{2em plus 1em minus 0.5em}
\setlength{\cftpartnumwidth}{4em}

\renewcommand{\cftpartpresnum}{Arc\space}
\renewcommand{\cftpartaftersnum}{:}

% Change chapter numbering on pages in book:
\renewcommand{\partname}{Arc}
\renewcommand{\partnamefont}{\normalfont\huge}
\renewcommand{\partnumfont}{\normalfont\huge}

\setlength{\cftbeforechapterskip}{0.2em plus 0.1em minus 0em}
\setlength{\cftchapterindent}{4em}
% Remove chapter numberings:
\makeatletter
\renewcommand{\cftchapterpresnum}{\begin{lrbox}{\@tempboxa}}
\renewcommand{\cftchapteraftersnum}{\end{lrbox}}
\makeatother
\setlength{\cftchapternumwidth}{0pt}

\makeatletter
\def\@makeschapterhead#1{%
    \vspace*{60\p@}%
    {\parindent \z@ \centering \reset@font
        \par\bigskip\nobreak
        \interlinepenalty\@M
        \openup 1em
        {\Huge\linespread{1.3} #1}\par\nobreak\openup -1em
            \vskip40\p@
    }
    \addcontentsline{toc}{chapter}{#1}
    \markboth{\MakeUppercase{#1}}{}
}
\def\@makechapterhead#1{%
    \vspace*{60\p@}%
    {\parindent \z@ \centering \reset@font
        \par\bigskip\nobreak
        \interlinepenalty\@M
        \openup 1em
        {\Huge #1}\par\nobreak\openup -1em
            \vskip40\p@
    }
}
\makeatother

\newcommand{\sectionbreak}{\begin{center}
    $\blacksquare$
\end{center}}
\newcommand{\strong}[1]{\textbf{#1}}
\newcommand{\msgbox}[1]{\vspace{1mm}\par\noindent\fbox{\parbox{\dimexpr\linewidth-2\fboxsep-2\fboxrule\relax}{#1}}\vspace{2mm}}

% layout check and fix
\checkandfixthelayout
\fixpdflayout

% BEGIN THE DOCUMENT
\begin{document}
\pagestyle{empty}
% the half title page
\halftitlepage
\cleardoublepage
% the title page
\titleM
\clearpage
% copyright page
\noindent{\small{This novel is entirely a work of fiction. The names, characters and incidents portrayed in it are the product of the author's imagination. Any resemblance to actual persons, living or dead, or events or localities is entirely coincidental.\par\vfill\noindent Paperback Edition\space\today
\\\copyright\space\theauthor. All rights reserved.
\par\vfill\noindent\theauthor\space originally published this online at \press{}. This is a fan copy of his book, and is not for sale. \par}}
\clearpage

% begin front matter
\frontmatter
\pagestyle{mystyle}
% preface
\chapter*{Preface}
\input{preface.tex}
% table of contents
\clearpage
\tableofcontents*

% begin main matter
\mainmatter

\input{01/arc.tex}
\input{02/arc.tex}
\input{03/arc.tex}
\input{04/arc.tex}

\begin{comment}
    \input{05/arc.tex}
    \input{06/arc.tex}
    \input{07/arc.tex}
    \input{08/arc.tex}
    \input{09/arc.tex}
    \input{10/arc.tex}
    
    \input{11/arc.tex}
    \input{12/arc.tex}
    \input{13/arc.tex}
    \input{14/arc.tex}
    \input{15/arc.tex}
    \input{16/arc.tex}
    \input{17/arc.tex}
    \input{18/arc.tex}
    \input{19/arc.tex}
    \input{20/arc.tex}
    
    \input{21/arc.tex}
    \input{22/arc.tex}
    \input{23/arc.tex}
    \input{24/arc.tex}
    \input{25/arc.tex}
    \input{26/arc.tex}
    \input{27/arc.tex}
    \input{28/arc.tex}
    \input{29/arc.tex}
    \input{30/arc.tex}
    
    \input{ep/arc.tex}
\end{comment}

% begin back matter

\end{document}
